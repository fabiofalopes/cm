# Desenvolvimento com widgets em Flutter - parte 2

Ok, neste vídeo vamos continuar a desenvolver o controlador de ar condicionado e vamos começar a preocupar-nos com o estado. O que é que é o estado? É basicamente a ideia de que isto, isto neste momento está fixo, mas nós queremos que seja dinâmico. E portanto, digamos que temos que transformar isto numa variável, alteramos isto numa variável, essa variável constitui o estado da aplicação.

O estado é algo que vai mudando ao longo da aplicação em reação a uma série de coisas, como seja clicar em botões, receber mensagens do servidor, etc. Tudo isso vai mudando o estado da aplicação e a interface gráfica tem que refletir esse estado o mais rapidamente possível. Portanto, eu estou à espera que quando carrego aqui no menos ou no mais, que isso comece por mudar uma variável que tem o valor de temperatura e depois isso seja refletido na interface gráfica com um novo valor.

Então vamos começar por criar aqui... Vamos então criar aqui uma variável temperatura que vai começar por ter o valor 25. Ok, e aqui vamos passar a usar essa variável. Vamos aumentar e diminuir essa variável consoante ele carregou no momento. Eu vou fazer agora isto de uma forma que talvez não seja a mais correta, mas para ser simples, que é vou usar esta label para decidir se carregou no botão menos ou no botão mais.

Isso não é necessariamente o mais correto porque estou a depender de uma coisa que é da interface gráfica - este menos, este mais é uma coisa que tem a ver com interface gráfica. Se eu mais tarde mudar o menos e o mais, por exemplo, para um ícone com menos e um ícone com mais, isso vai deixar de funcionar. Mas agora para o efeito é a forma mais simples de fazer isto. E portanto eu vou basicamente criar aqui um case menos, então eu vou pegar na temperatura e fazer menos menos, e case mais vou fazer o inverso.

Para vermos o que é que está a acontecer, vou também acrescentar aqui a temperatura. Ok, temos aqui a mesma temperatura a 25 e agora vou carregar mais e reparem o que é que está a acontecer: a temperatura não muda aqui, mas ele está-me a dizer que a temperatura passou a 28, a 29. Portanto ele está a afetar esta variável corretamente, mas a interface gráfica não está a refletir isso. Ou seja, eu estou a mudar o estado da minha aplicação corretamente, mas a interface gráfica não reflete isso.

Porque é que não reflete isso? Vamos pôr aqui um print no build e vamos ver se o build volta a ser chamado quando nós fazemos aquele mais, porque ele terá que ser... ele terá que redesenhar aqueles widgets, vou desenhar. Ok, vamos arrancar isto novamente. Ele até da primeira vez até vem 2 vezes ao ecrã. Isto é o próprio Flutter pode decidir desenhar várias vezes, mas agora reparem que eu farto-me de carregar aqui, ele nunca mais desenha.

Então como é que eu forço a desenhar? Aqui temos que voltar aqui aos slides para explicar uma coisa: o Flutter tem dois tipos de widget. Nós até agora usámos o StatelessWidget, que deve ser usado quando o widget não tem estado e só é desenhado uma vez, da primeira vez quando arrancamos a aplicação ele é desenhado. Mas se nós queremos que seja redesenhado quando o estado muda - é o que a gente quer - e queremos que ele tenha estado, então devemos passar a usar um StatefulWidget.

Então vamos voltar aqui e vamos muito facilmente converter. Reparem, este ControladorApp neste momento é um StatelessWidget e nós podemos ir aqui à lâmpada e dizer "converte para StatefulWidget". Basta isto! Ele inclusivamente mantém aqui este estado aqui, ok, e tudo igual. E portanto agora supostamente isto já devia funcionar. Vamos correr isto novamente.

Ok, ele diz que vai desenhar o ecrã, mas infelizmente ele parece ter o mesmo comportamento. Porque é que eu, mudando de StatelessWidget para StatefulWidget, ele não tem o mesmo comportamento? Porque não basta mudar para StatefulWidget. É preciso indicar ao próprio StatefulWidget que o estado foi modificado. Ele não consegue perceber que aqui neste momento nós estamos a modificar o estado do widget.

Então como é que nós indicamos, como é que nós avisamos o StatefulWidget que ele tem que redesenhar-se porque mudei o estado? Vamos rodear o nosso código que muda o estado dentro de um setState. É uma função... eu vou tirar isto aqui assim. É uma função que aquilo que eu colocar aqui dentro - neste caso vai ser isto: temperatura menos menos - o que significa é que eu colocar aqui dentro ele vai ser corrido de forma a redesenhar o ecrã. Ou seja, ele corre isto que aqui está e a seguir, modificou o estado, desenha o ecrã.

Vou só colocar no menos para vermos o efeito disto, só um momento. Ok, reparem que eu ao fazer um hot reload dele refrescou o ecrã, fez "vou desenhar o ecrã" e portanto foi buscar o valor que já lá estava, que era o 29, que a gente tinha vindo a atualizar o estado mas ele não tinha ainda refletido na interface gráfica. Agora refletiu.

E agora se eu fizer mais mantém-se o problema, mas se eu fizer menos reparem o que aconteceu... estão a ver? Ou seja, eu agora fiz mais, ele passou para 28, fiz mais passou para 29, passou para 30, e agora vou fazer menos, ele mostrou ali o 29, portanto baixou. Vou pôr os dois botões a funcionar e a refletirem no ecrã. Notem que ele disse no menos ele diz "não é", querendo mais "não é"... então já funciona, já funciona!

Portanto, resumo da coisa: quando nós queremos que a nossa aplicação passe a ter estado e que esse estado modifique o ecrã quando é modificado, então temos que começar por converter o nosso widget para StatefulWidget - foi o que eu fiz aqui - e ele criou aqui uma data de coisas, nomeadamente criar aqui uma classe State que não existia antes, mas este build é muito parecido com o que existia antes. E sempre que eu quiser modificar o estado desse widget, eu tenho que fazer dentro de um setState. Não se esqueçam disso! 